// App.js â€” TENtion KR v1.6.0 (Cafe Talk Focus Edition)
// âœ… ì¹´í…Œê³ ë¦¬ 4ê°œ ìœ ì§€ (Vibe/Friends/Try/Focus)
// âœ… ìŠ¬ë¡¯ = ì¹´í˜ + ëŒ€í™” ì£¼ì œë§Œ (í”„ëœì°¨ì´ì¦ˆ/ê°œì¸/ë£¸ ëœë¤ ë¯¹ìŠ¤)
// âœ… 200ê°œ ëŒ€ëŸ‰ ìƒì„± + ë„ì‹œ/ì‹œê°„ëŒ€ ë³€ê²½ ì‹œ ì¬ìƒì„±
// âœ… ì§€ì • ì‹œê°„Â·ì¹´í˜ê¹Œì§€ë§Œ ê´€ë¦¬(ì±…ì„ ê²½ê³„ UX) + ì—°ì¥ í•©ì˜ ì•ˆë‚´
// âœ… Expo Snack / RN Web OK (ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ)

import React, { useEffect, useMemo, useRef, useState } from "react";
import {
  SafeAreaView, View, Text, TouchableOpacity, TextInput, ScrollView,
  StyleSheet, Alert, Share, Platform, KeyboardAvoidingView
} from "react-native";

/* ---- default export ---- */
export default function App(){ return <Root/> }

/* =========================
   Copy / i18n (KO only)
========================= */
const T = {
  app:"TENtion KR",
  my:"ë‚´ ìŠ¬ë¡¯",
  create:"+ ì£¼ì œ ì œì•ˆ",
  searchPH:"ì£¼ì œ/ì¹´í˜/ë„ì‹œ ê²€ìƒ‰â€¦",
  sort:"ì •ë ¬",
  sortOpt:["ë§ˆê° ì„ë°•","ìµœì‹ ìˆœ","í‰ì ìˆœ"],
  time:"ì‹œê°„ëŒ€",
  timeBands:["ì´ë¥¸ ì•„ì¹¨","ì˜¤ì „","ì ì‹¬","ì˜¤í›„","ì €ë…","ì‹¬ì•¼"],
  duration:"ë¶„",
  noSlotsT:"í‘œì‹œí•  ìŠ¬ë¡¯ì´ ì—†ì–´ìš”",
  noSlotsS:"ë„ì‹œ/ì‹œê°„ëŒ€/ì‹œê°„(ë¶„)ì„ ë°”ê¿”ë´.",
  details:"ìƒì„¸",
  checkin:"ì°¸ì—¬í•˜ê¸°",
  leave:"ë‚˜ê°€ê¸°",
  share:"ê³µìœ ",
  back:"â† ë’¤ë¡œ",
  safetyNoteShort:"ê³µê³µì¥ì†Œ(ì¹´í˜)ì—ì„œ, ì•½ì†ëœ ì‹œê°„ê¹Œì§€ë§Œ.",
  // ë””í…Œì¼/ì²´í¬ì¸ì—ì„œ ì“°ëŠ” â€œê²½ê³„â€ ë¬¸êµ¬
  boundaryTitle:"TENtion ì•ˆë‚´",
  boundaryBody:
`â€¢ í…ì…˜ì´ ì œê³µí•˜ëŠ” ë§Œë‚¨ì€ â€œì§€ì •ëœ ì¹´í˜ + ì§€ì •ëœ ì‹œê°„â€ ê¸°ì¤€ì´ì•¼.
â€¢ ì‹œê°„ ì—°ì¥ì€ ë‘ ì‚¬ëŒì´ í•©ì˜í•´ì„œ ììœ¨ì ìœ¼ë¡œ ê²°ì •í•  ìˆ˜ ìˆì–´.
â€¢ ì§€ì • ì‹œê°„ ì´í›„/ë‹¤ë¥¸ ì¥ì†Œë¡œì˜ ì´ë™ì€ í…ì…˜ ê´€ë¦¬ ë²”ìœ„ ë°–ì´ì•¼.`,
};

/* =========================
   Categories (4)
========================= */
const CATS = [
  {key:"Vibe",    label:"Vibe",    icon:"â˜•", color:"#FF5CAB"}, // ì¸ìŠ¤ëŸ¬ìš´/ê°€ë²¼ìš´ í…ì…˜
  {key:"Friends", label:"Friends", icon:"ğŸ˜„", color:"#2EE778"}, // ì›ƒê¸°ê³  í¸í•œ í† í¬
  {key:"Try",     label:"Try",     icon:"ğŸ§ ", color:"#6AAEFF"}, // ìƒˆë¡œìš´ ì‹œë„/ì£¼ì œí˜•
  {key:"Focus",   label:"Focus",   icon:"ğŸ“š", color:"#FFA23B"}, // ì§„ì§€/ì„±ì¥/ì»¤ë¦¬ì–´
];
const catLabel = (k)=> CATS.find(x=>x.key===k)?.label || k;
const catIcon  = (k)=> CATS.find(x=>x.key===k)?.icon  || "ğŸ’¬";
const catColor = (k)=> CATS.find(x=>x.key===k)?.color || "#6AAEFF";

/* =========================
   Cities
========================= */
const CITY_LIST = [
  {code:"GN",  name:"ê°•ë‚¨/ì—­ì‚¼",   region:"ì„œìš¸"},
  {code:"HD",  name:"í™ëŒ€/í•©ì •",   region:"ì„œìš¸"},
  {code:"JS",  name:"ì ì‹¤/ì„ì´Œ",   region:"ì„œìš¸"},
  {code:"GS",  name:"ì„±ìˆ˜/ê±´ëŒ€",   region:"ì„œìš¸"},
  {code:"YD",  name:"ì—¬ì˜ë„",      region:"ì„œìš¸"},
  {code:"SEO", name:"ì„œìš¸(ê¸°íƒ€)",  region:"ì„œìš¸"},
  {code:"SUW", name:"ìˆ˜ì›",        region:"ê²½ê¸°"},
  {code:"GGN", name:"ê²½ê¸° ë¶ë¶€",   region:"ê²½ê¸°"},
  {code:"GGS", name:"ê²½ê¸° ë‚¨ë¶€",   region:"ê²½ê¸°"},
  {code:"ICN", name:"ì¸ì²œ/ì†¡ë„",   region:"ìˆ˜ë„ê¶Œ"},
];
const CITY = CITY_LIST.reduce((m,c)=>{ m[c.code]=c; return m; },{});
const cityName = (code)=> CITY[code]?.name || code;
const HOT5 = ["GN","HD","JS","GS","YD"];

/* =========================
   Constants
========================= */
const DUR_OPTS = [10,20,30,40,50,60,70,80,90,100];
const BAND_ANCHOR = { "ì´ë¥¸ ì•„ì¹¨":"06:30","ì˜¤ì „":"10:00","ì ì‹¬":"13:00","ì˜¤í›„":"16:00","ì €ë…":"19:30","ì‹¬ì•¼":"22:30" };

const ME = "Me";

/* =========================
   Helpers
========================= */
const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const pad2=(n)=>String(n).padStart(2,"0");
function parseHM(str){ if(!str||!/^\d{2}:\d{2}$/.test(str)) return null; const [h,m]=str.split(":").map(Number); return h*60+m; }
function addMin(startHM, delta){
  const m=(parseHM(startHM)||0)+delta;
  const mm=((m%1440)+1440)%1440;
  return `${pad2(Math.floor(mm/60))}:${pad2(mm%60)}`;
}
function spanMins(start,end){
  const s=parseHM(start),e=parseHM(end);
  if(s==null||e==null) return 10;
  let d=e-s; if(d<=0) d+=1440;
  return d;
}
const fmt24=(str)=>str||"â€”";
const uniq = (arr)=> Array.from(new Set(arr));
const includes = (arr, v)=> (arr||[]).includes(v);

function buildTodayTs(hm){
  const now=new Date();
  const [h,m]=hm.split(":").map(Number);
  return new Date(now.getFullYear(),now.getMonth(),now.getDate(),h,m,0).getTime();
}
function getState(nowMs, startHM, durMin){
  const start = buildTodayTs(startHM);
  const end   = start + (durMin||10)*60*1000;
  if(nowMs < start) return {state:"upcoming", secsToStart: Math.floor((start-nowMs)/1000)};
  if(nowMs <= end)  return {state:"live", secsToStart:0};
  return {state:"ended", secsToStart:0};
}
function fmtHMS(secs){
  const h=Math.floor(secs/3600);
  const m=Math.floor((secs%3600)/60);
  const s=secs%60;
  return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
}
const tintByMins=(mins)=> mins<=0?{color:"#666"}: mins<=10?{color:"#FF5A5A",fontWeight:"900"}: mins<=30?{color:"#FF9F1A",fontWeight:"900"}:{color:"#6AAEFF"};
const stars=(n)=>!n?"â­ â€”":"â­".repeat(Math.max(1,Math.min(5,Math.round(n))));

/* =========================
   Cafe DB (Brand / Private / Room)
   - í”„ëœì°¨ì´ì¦ˆ/ê°œì¸/ë£¸ ì„ì–´ì„œ â€œì•ˆì •+í™â€ ëª¨ë‘ ì»¤ë²„
========================= */
const CAFE_DB = [
  { name: "ìŠ¤íƒ€ë²…ìŠ¤",      type: "Brand",  info: "ë„“ê³  ë¬´ë‚œ, ì²« ë§Œë‚¨ ì•ˆì •ê°" },
  { name: "íˆ¬ì¸í”Œë ˆì´ìŠ¤",  type: "Brand",  info: "ì¢Œì„ ë„‰ë„‰ + ë””ì €íŠ¸" },
  { name: "í• ë¦¬ìŠ¤",        type: "Brand",  info: "ì¹´ê³µ ë¶„ìœ„ê¸°, ëŒ€í™” ë¶€ë‹´ ì ìŒ" },
  { name: "í´ë°”ì…‹",        type: "Brand",  info: "ì¡°ìš©-ì°¨ë¶„ ë¼ì¸" },
  { name: "ë©”ê°€ì»¤í”¼(ëŒ€í˜•)", type: "Brand",  info: "ê°€ì„±ë¹„ + ì ‘ê·¼ì„±" },

  { name: "í™í•œ ê°œì¸ì¹´í˜",   type: "Private", info: "ê°ì„±/ë¬´ë“œ, ëŒ€í™”ê°€ ì˜ í’€ë¦¼" },
  { name: "ì°½ê³ í˜• ì¹´í˜",     type: "Private", info: "í…Œì´ë¸” ë„“ìŒ, ëˆˆì¹˜ ì ìŒ" },
  { name: "ë¶ì¹´í˜",          type: "Private", info: "ì¡°ìš©+ì •ëˆ, ì§„ì§€ í† í¬ ì¢‹ìŒ" },

  { name: "ë¯¸íŒ…ë£¸ ì¹´í˜",     type: "Room", info: "ìŠ¤í„°ë””ë£¸/ëŒ€í˜•í…Œì´ë¸” ê°€ëŠ¥" },
  { name: "ìŠ¤í„°ë”” ì¹´í˜",     type: "Room", info: "ì§‘ì¤‘/í”„ë¡œì íŠ¸ í† í¬ ìµœì " },
];

function weightedCafePick(){
  // Brand 0.60 / Private 0.30 / Room 0.10
  const r=Math.random();
  const bucket = r<0.60 ? "Brand" : (r<0.90 ? "Private" : "Room");
  const list = CAFE_DB.filter(x=>x.type===bucket);
  return list[Math.floor(Math.random()*list.length)];
}
function cafeBadgeText(type){
  if(type==="Brand") return "Brand";
  if(type==="Room")  return "Room";
  return "Hot";
}
function cafeBadgeTone(type){
  if(type==="Brand") return "#3EC6FF";
  if(type==="Room")  return "#2EE778";
  return "#FF5CAB";
}

/* =========================
   Topic Pool (ì¹´í˜ ëŒ€í™” ì£¼ì œë§Œ!)
   - ê°€ë³ê²Œ/í™í•˜ê²Œ/ì¦ê²ê²Œ/ì§„ì§€í•˜ê²Œ ì„ì–´ì¤Œ
========================= */
const TOPIC_POOL = {
  Vibe: [
    "ìš”ì¦˜ ì„¤ë ˆëŠ” ê²ƒ í•œ ê°€ì§€",
    "ì²«ì¸ìƒ vs ì§„ì§œ ì„±ê²©",
    "ì—°ì•  ì–˜ê¸° ë§ê³ ë„ ì„¤ë ˜ ë§Œë“œëŠ” ë²•",
    "í˜¸ê°ì´ ìƒê¸°ëŠ” ë§íˆ¬/ë§¤ë„ˆ",
    "ë‚´ê°€ ì€ê·¼ ì¢‹ì•„í•˜ëŠ” ì·¨í–¥",
    "â€˜í¸í•œ ì‚¬ëŒâ€™ì˜ íŠ¹ì§•",
    "ê°ì • ê¸°ë³µ ë‹¤ë£¨ëŠ” ë‚˜ë§Œì˜ ë°©ë²•",
  ],
  Friends: [
    "ìµœê·¼ ì œì¼ ì›ƒê²¼ë˜ ì¼",
    "ì‹¤íŒ¨ë‹´ í•˜ë‚˜(ì›ƒê¸°ê²Œ)",
    "TMI êµí™˜ 10ë¶„",
    "ìš”ì¦˜ ë¹ ì§„ ë°ˆ/ì½˜í…ì¸ ",
    "ìˆ¨ê²¨ë‘” ë§›ì§‘/ì¹´í˜ ì·¨í–¥",
    "ì£¼ë§ì— ë­ í•˜ê³  ë†€ì•„?",
    "ë‚˜ì˜ ê¸°ìƒì²œì™¸ ìŠµê´€",
  ],
  Try: [
    "2026ì— í•´ë³´ê³  ì‹¶ì€ ì‘ì€ ì‹¤í—˜",
    "ìš”ì¦˜ ë°°ìš°ê³  ì‹¶ì€ ê²ƒ",
    "ìƒˆë¡œìš´ ë£¨í‹´ í•˜ë‚˜ ì¶”ì²œ",
    "í˜¼ì í•˜ê¸° ì–´ë ¤ìš´ ë„ì „",
    "MBTI ë§ê³  â€˜ë‚˜â€™ë¥¼ ì„¤ëª…í•˜ëŠ” ë‹¨ì–´",
    "ì—¬í–‰/ì·¨ë¯¸ ë²„í‚·ë¦¬ìŠ¤íŠ¸",
    "ìš”ì¦˜ ê´€ì‹¬ì‚¬ í•œ ì¤„ ë°œí‘œ",
  ],
  Focus: [
    "ì»¤ë¦¬ì–´ ê³ ë¯¼ 10ë¶„ ì••ì¶•",
    "ì´ì§/ì—°ë´‰/ì„±ì¥ ê³ ë¯¼",
    "ìš”ì¦˜ ì§‘ì¤‘í•˜ëŠ” í”„ë¡œì íŠ¸",
    "ìƒì‚°ì„± ë£¨í‹´/ë„êµ¬ ê³µìœ ",
    "ì½ì€ ì±…/ì•„í‹°í´ í•œ ì¤„ ìš”ì•½",
    "ì¬í…Œí¬ ì´ˆë³´ê°€ ê¶ê¸ˆí•œ ê²ƒ",
    "ë©˜íƒˆ ê´€ë¦¬: ë¶ˆì•ˆ ì¤„ì´ëŠ” ë°©ë²•",
  ],
};

function defaultDesc(cat){
  if(cat==="Vibe")    return "ê°€ë³ê³  ì†”ì§í•˜ê²Œ. ë¶„ìœ„ê¸° ì¢‹ê²Œ ëŒ€í™”í•´ìš”.";
  if(cat==="Friends") return "ì¬ë°Œê²Œ ë– ë“¤ê³  ì›ƒëŠ” í† í¬.";
  if(cat==="Try")     return "ìƒˆë¡œìš´ ì£¼ì œ/ì‹œë„. ì§§ê²Œ ì‹¤í—˜í•´ìš”.";
  return               "ì§„ì§€í•˜ê²Œ ì •ë¦¬í•˜ê³ , ì§§ê²Œ ì–»ì–´ê°€ìš”.";
}

/* =========================
   Auto Slot Generator (Cafe Talk)
========================= */
function guessBandFromStart(hm){
  const m=parseHM(hm)||0,h=Math.floor(m/60);
  if(h<9) return "ì´ë¥¸ ì•„ì¹¨";
  if(h<12) return "ì˜¤ì „";
  if(h<15) return "ì ì‹¬";
  if(h<19) return "ì˜¤í›„";
  if(h<22) return "ì €ë…";
  return "ì‹¬ì•¼";
}
function generateCafeTalkSlots({ cityCode="GN", band="ì €ë…", count=20 }){
  const list=[];
  const anchor = BAND_ANCHOR[band] || "19:30";
  const cats = ["Vibe","Friends","Try","Focus"];

  for(let i=0;i<count;i++){
    const type = cats[Math.floor(Math.random()*cats.length)];
    const cafe = weightedCafePick();

    const d = DUR_OPTS[Math.floor(Math.random()*DUR_OPTS.length)];
    const start = addMin(anchor, 10 * Math.floor(Math.random()*18)); // ì•½ 3ì‹œê°„ ë²”ìœ„
    const end = addMin(start, d);

    const topic = TOPIC_POOL[type][Math.floor(Math.random()*TOPIC_POOL[type].length)];
    const place = `${cityName(cityCode)} Â· ${cafe.name}`;

    list.push({
      id: Date.now()+Math.floor(Math.random()*1e6),
      type,
      city: cityCode,
      band: guessBandFromStart(start),
      title: `${topic}`,
      place,
      cafeType: cafe.type,
      cafeInfo: cafe.info,
      start,
      end,
      totalMins: spanMins(start,end),
      minsLeft: Math.max(5, Math.floor(spanMins(start,end)*0.8)),
      attendees: [],
      proofScore: Math.round(3 + Math.random()*2),
      desc: defaultDesc(type),
    });
  }
  return list.sort((a,b)=>b.id-a.id);
}

/* =========================
   Root
========================= */
function Root(){
  const [nowMs,setNowMs]=useState(Date.now());
  useEffect(()=>{ const id=setInterval(()=>setNowMs(Date.now()),1000); return ()=>clearInterval(id); },[]);

  const [activeCat,setActiveCat]=useState(""); // ""=ALL
  const [dur,setDur]=useState(10);
  const [band,setBand]=useState(T.timeBands[4]); // ì €ë…
  const [sortBy,setSortBy]=useState(T.sortOpt[0]);
  const [selectedCities,setSelectedCities]=useState(HOT5);
  const [showCitySheet,setShowCitySheet]=useState(false);
  const [showSortSheet,setShowSortSheet]=useState(false);
  const [myOnly,setMyOnly]=useState(false);
  const [search,setSearch]=useState("");

  const scrollRef=useRef(null);

  const [slots,setSlots]=useState([]);

  // 200ê°œ ìƒì„± (ì„ íƒ ë„ì‹œ/ì‹œê°„ëŒ€ ê¸°ë°˜)
  useEffect(()=>{
    const base = selectedCities.length ? selectedCities : HOT5;
    const per  = Math.max(10, Math.floor(200 / base.length));
    const packs = base.flatMap(code=>generateCafeTalkSlots({ cityCode:code, band, count:per }));
    setSlots(packs.slice(0,200));
  },[band, selectedCities]);

  const resetHome=()=>{
    setActiveCat("");
    setDur(10);
    setBand(T.timeBands[4]);
    setSortBy(T.sortOpt[0]);
    setSearch("");
    setMyOnly(false);
    setSelectedCities(HOT5);
    scrollRef.current?.scrollTo({y:0,animated:true});
  };

  const toggleCity=(code)=>{
    setSelectedCities(prev=>{
      const has = prev.includes(code);
      const next = has ? prev.filter(x=>x!==code) : [...prev, code];
      return next;
    });
  };

  const list = useMemo(()=>{
    let arr = slots.slice();

    if(activeCat) arr = arr.filter(s=>s.type===activeCat);

    const cities = selectedCities.length ? selectedCities : HOT5;
    arr = arr.filter(s=>includes(cities, s.city));

    // ì‹œê°„ëŒ€ í•„í„°(ìƒë‹¨ íƒ­ ê¸°ì¤€)
    arr = arr.filter(s=>s.band===band);

    // duration í•„í„° (ì„ íƒ ë¶„ ì´ìƒ)
    arr = arr.filter(s => (s.totalMins||10) >= dur);

    if(myOnly) arr = arr.filter(s => includes(s.attendees, ME));

    if(search.trim()){
      const q=search.trim().toLowerCase();
      arr = arr.filter(s=>{
        const txt = `${s.title} ${s.place} ${cityName(s.city)} ${s.band} ${s.cafeType}`.toLowerCase();
        return txt.includes(q);
      });
    }

    if(sortBy===T.sortOpt[0]) arr.sort((a,b)=>(a.minsLeft||1e9)-(b.minsLeft||1e9));
    if(sortBy===T.sortOpt[1]) arr.sort((a,b)=>b.id-a.id);
    if(sortBy===T.sortOpt[2]) arr.sort((a,b)=>(b.proofScore||0)-(a.proofScore||0));

    return arr;
  },[slots,activeCat,dur,band,sortBy,selectedCities,search,myOnly]);

  const [screen,setScreen]=useState("home");
  const [selId,setSelId]=useState(null);

  const join=(slot)=>{
    if(!slot) return;

    const {state} = getState(nowMs, slot.start, slot.totalMins || 10);
    if(state==="ended"){
      Alert.alert("ì¢…ë£Œë¨","ì´ë¯¸ ì¢…ë£Œëœ ìŠ¬ë¡¯ì´ì•¼.");
      return;
    }

    // âœ… ê²½ê³„ UX: ì²´í¬ì¸ ì‹œ ì•ˆë‚´
    Alert.alert("ì°¸ì—¬ í™•ì •", T.boundaryBody);

    setSlots(prev=>prev.map(s=>{
      if(s.id!==slot.id) return s;
      const already = includes(s.attendees, ME);
      const nextAtt = already ? s.attendees : [...(s.attendees||[]), ME];
      return {...s, attendees: nextAtt};
    }));
  };

  const leave=(slot)=>{
    if(!slot) return;
    setSlots(prev=>prev.map(s=>{
      if(s.id!==slot.id) return s;
      return {...s, attendees:(s.attendees||[]).filter(x=>x!==ME)};
    }));
    Alert.alert("ë‚˜ê°€ê¸°","ì™„ë£Œ");
  };

  const shareSlot=async(slot)=>{
    if(!slot) return;
    try{
      await Share.share({
        message:
`TENtion â€¢ ${catLabel(slot.type)} ${catIcon(slot.type)}
${slot.title}
ğŸ“ ${slot.place}
ğŸ•’ ${fmt24(slot.start)} ~ ${fmt24(slot.end)} (${slot.totalMins}ë¶„)
${T.safetyNoteShort}`
      });
    }catch(e){}
  };

  // â€œì£¼ì œ ì œì•ˆâ€ (create) â€” ì‹¤ì œ ìŠ¬ë¡¯ë„ ìƒì„±í•´ì£¼ë˜ ì¹´í˜/ëŒ€í™” ê·œì¹™ ìœ ì§€
  const [createOpen,setCreateOpen]=useState(false);
  const [form,setForm]=useState({
    cat:"",
    city:"GN",
    topic:"",
    dur:10,
    start:"19:30",
    _cityPick:false
  });

  const openCreate=()=>{
    const firstSel = selectedCities[0] || "GN";
    setForm({
      cat: activeCat || "",
      city: firstSel,
      topic:"",
      dur:10,
      start: BAND_ANCHOR[band] || "19:30",
      _cityPick:false
    });
    setCreateOpen(true);
  };

  const createSlot=()=>{
    const cat = (form.cat || "Try");
    const city = (form.city || "GN");
    const mins = clamp(form.dur,10,100);

    const start = (parseHM(form.start)!=null) ? form.start : (BAND_ANCHOR[band] || "19:30");
    const end = addMin(start, mins);

    const cafe = weightedCafePick();
    const place = `${cityName(city)} Â· ${cafe.name}`;

    const topic = (form.topic || TOPIC_POOL[cat][Math.floor(Math.random()*TOPIC_POOL[cat].length)]).trim();

    const s = {
      id: Date.now()+Math.floor(Math.random()*1e6),
      type: cat,
      city,
      band: guessBandFromStart(start),
      title: topic,
      place,
      cafeType: cafe.type,
      cafeInfo: cafe.info,
      start,
      end,
      totalMins: mins,
      minsLeft: Math.max(5, Math.floor(mins*0.8)),
      attendees: [],
      proofScore:0,
      desc: defaultDesc(cat),
    };

    setSlots(prev=>[s, ...prev]);
    setCreateOpen(false);

    setActiveCat(cat);
    setBand(s.band); // ìƒì„± ìŠ¬ë¡¯ì´ ì†í•œ ë°´ë“œë¡œ ë§ì¶°ì„œ ë°”ë¡œ ë³´ì´ê²Œ
    setSelectedCities(prev=> uniq(prev.includes(city)?prev:[...prev, city]));
    setTimeout(()=>scrollRef.current?.scrollTo({y:0,animated:true}), 50);

    Alert.alert("ì œì•ˆ ì™„ë£Œ","í”¼ë“œ ìµœìƒë‹¨ì— ì¶”ê°€í–ˆì–´.");
  };

  return(
    <SafeAreaView style={styles.container}>
      {/* HEADER */}
      <View style={styles.headerRow}>
        <TouchableOpacity onPress={resetHome} style={{flexDirection:"row",alignItems:"flex-end"}} hitSlop={10}>
          <Text style={styles.logo}>{T.app}</Text>
        </TouchableOpacity>

        <View style={{flexDirection:"row",gap:8,alignItems:"center"}}>
          <TouchableOpacity
            style={[styles.secondarySm, myOnly && styles.secondarySmOn]}
            onPress={()=>setMyOnly(v=>!v)}
          >
            <Text style={[styles.secondarySmT, myOnly && styles.secondarySmTOn]}>{T.my}</Text>
          </TouchableOpacity>

          <TouchableOpacity style={styles.primarySm} onPress={openCreate}>
            <Text style={styles.primarySmT}>{T.create}</Text>
          </TouchableOpacity>
        </View>
      </View>

      <ScrollView
        ref={scrollRef}
        contentContainerStyle={{paddingBottom:90}}
        showsVerticalScrollIndicator={false}
        overScrollMode="never"
        keyboardShouldPersistTaps="handled"
      >
        {/* CATEGORIES â€” 4ì¹© ê³ ì • 1ì¤„ */}
        <View style={styles.catRow}>
          {CATS.map(c=>{
            const on = activeCat===c.key;
            return(
              <TouchableOpacity
                key={c.key}
                onPress={()=>setActiveCat(p=>p===c.key?"":c.key)}
                style={[
                  styles.catChip,
                  {borderColor:c.color},
                  on && {backgroundColor:c.color+"22"}
                ]}
              >
                <Text style={[styles.catText,{color:c.color}]} numberOfLines={1}>
                  {c.icon} {c.label}
                </Text>
              </TouchableOpacity>
            );
          })}
        </View>

        {/* Row: duration â€¢ sort */}
        <View style={styles.row2}>
          <Stepper
            label={T.duration}
            value={dur}
            step={10}
            onMinus={()=>setDur(clamp(dur-10,10,100))}
            onPlus={()=>setDur(clamp(dur+10,10,100))}
          />
          <TouchableOpacity style={styles.sortBtn} onPress={()=>setShowSortSheet(true)}>
            <Text style={styles.sortBtnT} numberOfLines={1}>{T.sort}</Text>
          </TouchableOpacity>
        </View>

        {/* ì‹œê°„ëŒ€ */}
        <View style={styles.bandRow}>
          {T.timeBands.map(b=>(
            <TouchableOpacity
              key={b}
              onPress={()=>setBand(b)}
              style={[styles.bandChip, band===b && styles.bandChipOn]}
            >
              <Text style={[styles.bandChipT, band===b && styles.bandChipTOn]} numberOfLines={1}>{b}</Text>
            </TouchableOpacity>
          ))}
        </View>

        {/* HOT5 + ì§€ì—­ì„ íƒ */}
        <View style={styles.hotRow}>
          {HOT5.map(code=>{
            const on = selectedCities.includes(code);
            return(
              <TouchableOpacity
                key={code}
                onPress={()=>toggleCity(code)}
                style={[styles.cityChip, on && styles.cityChipActive]}
              >
                <Text style={[styles.cityChipT, on && styles.cityChipTActive]} numberOfLines={1}>
                  {cityName(code)}
                </Text>
              </TouchableOpacity>
            );
          })}
          <TouchableOpacity style={styles.moreChip} onPress={()=>setShowCitySheet(true)}>
            <Text style={styles.moreChipT} numberOfLines={1}>ì§€ì—­ì„ íƒ â–¾</Text>
          </TouchableOpacity>
        </View>

        {/* SEARCH */}
        <TextInput
          value={search}
          onChangeText={setSearch}
          placeholder={T.searchPH}
          placeholderTextColor="#7a8596"
          style={styles.search}
        />

        {/* FEED */}
        {list.length===0 && (
          <View style={styles.empty}>
            <Text style={styles.emptyT}>{T.noSlotsT}</Text>
            <Text style={styles.emptyS}>{T.noSlotsS}</Text>
          </View>
        )}

        {list.map(s=>(
          <Card
            key={s.id}
            slot={s}
            nowMs={nowMs}
            onDetails={()=>{ setSelId(s.id); setScreen("detail"); }}
            onPrimary={()=>join(s)}
          />
        ))}

        <View style={styles.noteBox}>
          <Text style={styles.note}>{T.safetyNoteShort} Â· ì—°ì¥ì€ í•©ì˜ Â· ì´í›„/ì´ë™ì€ í…ì…˜ ë²”ìœ„ ë°–</Text>
        </View>
      </ScrollView>

      {/* SORT SHEET */}
      {showSortSheet && (
        <ActionSheet
          title={T.sort}
          value={sortBy}
          options={T.sortOpt}
          onPick={(v)=>{ setSortBy(v); setShowSortSheet(false); }}
          onCancel={()=>setShowSortSheet(false)}
        />
      )}

      {/* CITY SHEET */}
      {showCitySheet && (
        <MultiCitySheet
          currentList={selectedCities}
          onApply={(codes)=>{ setSelectedCities(codes); setShowCitySheet(false); }}
          onClose={()=>setShowCitySheet(false)}
        />
      )}

      {/* CREATE */}
      {createOpen && (
        <CreateModal
          form={form}
          setForm={setForm}
          onClose={()=>setCreateOpen(false)}
          onCreate={createSlot}
          currentBand={band}
        />
      )}

      {/* DETAILS */}
      {screen==="detail" && selId && (
        <Details
          slot={slots.find(s=>s.id===selId)}
          nowMs={nowMs}
          onBack={()=>setScreen("home")}
          onShare={()=>shareSlot(slots.find(s=>s.id===selId))}
          onJoin={()=>join(slots.find(s=>s.id===selId))}
          onLeave={()=>leave(slots.find(s=>s.id===selId))}
        />
      )}
    </SafeAreaView>
  );
}

/* =========================
   UI Components
========================= */
function Stepper({label,value,step=1,onMinus,onPlus}){
  return(
    <View style={styles.stepper}>
      <TouchableOpacity style={styles.stepBtn} onPress={onMinus} hitSlop={{top:8,bottom:8,left:8,right:8}}>
        <Text style={styles.stepBtnT}>âˆ’</Text>
      </TouchableOpacity>
      <View style={styles.stepMid}>
        <Text style={styles.stepVal} numberOfLines={1}>{value}</Text>
        <Text style={styles.stepLbl} numberOfLines={1}>{label}</Text>
      </View>
      <TouchableOpacity style={styles.stepBtn} onPress={onPlus} hitSlop={{top:8,bottom:8,left:8,right:8}}>
        <Text style={styles.stepBtnT}>ï¼‹</Text>
      </TouchableOpacity>
    </View>
  );
}

function Card({slot,onDetails,onPrimary,nowMs}){
  if(!slot) return null;

  const {state, secsToStart} = getState(nowMs, slot.start, slot.totalMins || 10);
  const tint  = tintByMins(slot.minsLeft || 10);
  const ratio = (slot.totalMins || 10) ? Math.max(0, (slot.minsLeft||0))/(slot.totalMins||10) : 0;

  const rightBadge = (
    state==="upcoming"
      ? <MiniBadge text={`â³ ${fmtHMS(secsToStart)}`} tone="#3EC6FF"/>
      : state==="live"
        ? <MiniBadge text={`ì§„í–‰ì¤‘`} tone="#2EE778"/>
        : <MiniBadge text={`ì¢…ë£Œ`} tone="#666"/>
  );

  return(
    <View style={[styles.card,{borderColor:catColor(slot.type)}]}>
      <View style={styles.cardHead}>
        <Text style={[styles.cardType,{color:catColor(slot.type)}]} numberOfLines={1}>
          {catIcon(slot.type)} {catLabel(slot.type)}  â€¢  {cityName(slot.city)}  â€¢  {slot.band}
        </Text>
        <View style={{flexDirection:"row",gap:6,alignItems:"center"}}>
          <MiniBadge text={cafeBadgeText(slot.cafeType)} tone={cafeBadgeTone(slot.cafeType)} />
          {rightBadge}
        </View>
      </View>

      <Text style={styles.cardTitle} numberOfLines={2}>{slot.title}</Text>

      <Text style={styles.cardLine}>
        ğŸ“ {slot.place} â€¢ {slot.cafeInfo}
      </Text>

      <Text style={styles.cardLine}>
        ğŸ•’ {fmt24(slot.start)} ~ {fmt24(slot.end)} â€¢ {Math.max(10,slot.totalMins||10)}ë¶„ â€¢ <Text style={tint}>{fmtHMS(Math.max(0, Math.floor((slot.minsLeft||0)*60)))}</Text>
      </Text>

      <Text style={styles.cardLine}>ğŸ‘¥ {slot.attendees?.length || 0}ëª… â€¢ {stars(slot.proofScore)}</Text>

      <View style={styles.progOuter}>
        <View style={[styles.progInner,{width:`${Math.max(4,ratio*100)}%`, backgroundColor:tint.color||"#6AAEFF"}]} />
      </View>

      <Text style={styles.cardDesc} numberOfLines={2}>{slot.desc}</Text>

      <View style={styles.cardFoot}>
        <TouchableOpacity style={styles.outBtn} onPress={onDetails}>
          <Text style={styles.outBtnT}>{T.details}</Text>
        </TouchableOpacity>

        <TouchableOpacity style={styles.inBtn} onPress={onPrimary}>
          <Text style={styles.inBtnT}>{T.checkin}</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
}

function Details({slot,onBack,onShare,onJoin,onLeave,nowMs}){
  if(!slot) return null;
  const joined = (slot.attendees||[]).includes(ME);

  const {state, secsToStart} = getState(nowMs, slot.start, slot.totalMins || 10);
  const labelTone = state==="live" ? "#2EE778" : (state==="upcoming" ? "#3EC6FF" : "#666");
  const labelText = state==="upcoming" ? `â³ ${fmtHMS(secsToStart)}` : (state==="live" ? "ì§„í–‰ì¤‘" : "ì¢…ë£Œ");

  const tint   = tintByMins(slot.minsLeft || 0);
  const ratio  = (slot.totalMins||10) ? Math.max(0, (slot.minsLeft||0))/(slot.totalMins||10) : 0;

  return(
    <View style={styles.detailWrap}>
      <SafeAreaView />
      <ScrollView contentContainerStyle={{padding:18,paddingBottom:120}} showsVerticalScrollIndicator={false} keyboardShouldPersistTaps="handled">
        <TouchableOpacity onPress={onBack} hitSlop={12}>
          <Text style={styles.back}>{T.back}</Text>
        </TouchableOpacity>

        <View style={[styles.detailsBox,{borderColor:catColor(slot.type)}]}>
          <View style={styles.badgeRow}>
            <MiniBadge text={`${catIcon(slot.type)} ${catLabel(slot.type)}`} tone={catColor(slot.type)} />
            <MiniBadge text={cafeBadgeText(slot.cafeType)} tone={cafeBadgeTone(slot.cafeType)} />
            <MiniBadge text={labelText} tone={labelTone} />
          </View>

          <Text style={[styles.detailsTitle,{color:catColor(slot.type)}]} numberOfLines={3}>
            {slot.title}
          </Text>

          <View style={styles.infoBlock}>
            <Text style={styles.infoLine}>ğŸ“ {slot.place} Â· {slot.cafeInfo}</Text>
            <Text style={styles.infoLine}>ğŸ•’ {fmt24(slot.start)} ~ {fmt24(slot.end)} Â· {slot.totalMins}ë¶„</Text>
            <Text style={styles.infoLine}>ğŸ‘¥ ì°¸ì—¬ì {slot.attendees?.length || 0}ëª… Â· {stars(slot.proofScore)}</Text>
          </View>

          <View style={styles.section}>
            <Text style={styles.secTitle}>â±ï¸ ì§„í–‰ìƒí™©</Text>
            <Text style={styles.cardLine}>
              ë‚¨ì€ ê¸°ì¤€ì‹œê°„: <Text style={tint}>{Math.max(0,slot.minsLeft||0)}ë¶„</Text>
            </Text>
            <View style={styles.progOuter}>
              <View style={[styles.progInner,{width:`${Math.max(4,ratio*100)}%`, backgroundColor:tint.color||"#6AAEFF"}]} />
            </View>
          </View>

          {/* âœ… ê²½ê³„ UX: ë””í…Œì¼ì—ì„œ ë˜ í•œ ë²ˆ */}
          <View style={styles.policyBox}>
            <Text style={styles.secTitle}>âœ… {T.boundaryTitle}</Text>
            <Text style={styles.policyLine}>â€¢ ë§Œë‚¨ì€ â€œì§€ì •ëœ ì¹´í˜ + ì§€ì •ëœ ì‹œê°„â€ ê¸°ì¤€</Text>
            <Text style={styles.policyLine}>â€¢ ì‹œê°„ ì—°ì¥ì€ ë‘ ì‚¬ëŒì´ í•©ì˜í•´ì„œ ììœ¨ ê²°ì •</Text>
            <Text style={styles.policyLine}>â€¢ ì´í›„ ë§Œë‚¨/ì¥ì†Œ ì´ë™ì€ í…ì…˜ ê´€ë¦¬ ë²”ìœ„ ë°–</Text>
          </View>

          <View style={{flexDirection:"row",gap:10,marginTop:12}}>
            <TouchableOpacity style={styles.secondaryBtn} onPress={onShare}>
              <Text style={styles.secondaryText}>{T.share}</Text>
            </TouchableOpacity>

            {!joined && (
              <TouchableOpacity style={styles.primaryBtn} onPress={onJoin}>
                <Text style={styles.primaryText}>{T.checkin}</Text>
              </TouchableOpacity>
            )}

            {joined && (
              <TouchableOpacity
                style={[styles.secondaryBtn,{borderColor:"#FF5A5A",backgroundColor:"#FF5A5A22"}]}
                onPress={onLeave}
              >
                <Text style={[styles.secondaryText,{color:"#FF5A5A"}]}>{T.leave}</Text>
              </TouchableOpacity>
            )}
          </View>
        </View>
      </ScrollView>
    </View>
  );
}

function MiniBadge({text,tone}){
  return(
    <View style={[styles.miniBadge,{backgroundColor:tone+"22",borderColor:tone}]}>
      <Text style={[styles.miniBadgeT,{color:tone}]}>{text}</Text>
    </View>
  );
}

function ActionSheet({title,value,options,onPick,onCancel}){
  return(
    <View style={styles.sheetWrap}>
      <TouchableOpacity style={{flex:1}} onPress={onCancel} />
      <View style={styles.sheetCard}>
        <View style={styles.sheetHandle}/>
        <Text style={styles.sheetTitle}>{title}</Text>
        {options.map(opt=>(
          <TouchableOpacity key={opt} style={styles.sheetItem} onPress={()=>onPick(opt)}>
            <Text style={[styles.sheetItemT, value===opt && {color:"#3EC6FF"}]}>
              {opt}{value===opt?" â€¢":""}
            </Text>
          </TouchableOpacity>
        ))}
        <TouchableOpacity style={[styles.primaryBtn,{marginTop:6}]} onPress={onCancel}>
          <Text style={styles.primaryText}>OK</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
}

/* Multi City Sheet */
function MultiCitySheet({currentList,onApply,onClose}){
  const [local,setLocal]=useState(uniq(currentList || []));
  const toggle=(code)=> setLocal(prev=>{
    const has = prev.includes(code);
    return has ? prev.filter(x=>x!==code) : [...prev, code];
  });
  const apply=()=> onApply(uniq(local));
  const reset=()=> setLocal([]);

  // ê·¸ë£¹
  const groups = {};
  CITY_LIST.forEach(c=>{
    const g = c.region || "ê¸°íƒ€";
    if(!groups[g]) groups[g]=[];
    groups[g].push(c);
  });

  return(
    <View style={styles.sheetWrap}>
      <TouchableOpacity style={{flex:1}} onPress={onClose} />
      <View style={styles.sheetCardTall}>
        <View style={styles.sheetHandle}/>
        <Text style={styles.sheetTitle}>ì§€ì—­(ë³µìˆ˜ì„ íƒ)</Text>

        <ScrollView style={{maxHeight:420}} showsVerticalScrollIndicator={false} overScrollMode="never">
          {Object.keys(groups).map(gr=>(
            <View key={gr} style={{marginBottom:8}}>
              <Text style={{color:"#9aa",marginBottom:6,fontWeight:"800"}}>{gr}</Text>
              {groups[gr].map(c=>{
                const on = local.includes(c.code);
                return(
                  <TouchableOpacity key={c.code} style={styles.cityRow} onPress={()=>toggle(c.code)}>
                    <View style={[styles.chk, on && styles.chkOn]}>
                      <Text style={[styles.chkT, on && styles.chkTOn]}>âœ“</Text>
                    </View>
                    <Text style={[styles.cityRowT, on && {color:"#3EC6FF"}]} numberOfLines={1}>
                      {c.name}
                    </Text>
                  </TouchableOpacity>
                );
              })}
            </View>
          ))}
        </ScrollView>

        <View style={{flexDirection:"row",gap:8,marginTop:10,justifyContent:"flex-end"}}>
          <TouchableOpacity style={styles.secondaryBtn} onPress={reset}>
            <Text style={styles.secondaryText}>ì´ˆê¸°í™”</Text>
          </TouchableOpacity>
          <TouchableOpacity style={styles.primaryBtn} onPress={apply}>
            <Text style={styles.primaryText}>ì ìš©</Text>
          </TouchableOpacity>
        </View>
      </View>
    </View>
  );
}

/* Create Modal: â€œì£¼ì œ ì œì•ˆâ€ */
function CreateModal({form,setForm,onClose,onCreate,currentBand}){
  const setDur=(v)=>setForm(f=>({...f,dur:clamp(v,10,100)}));

  return(
    <View style={styles.modalWrap}>
      <SafeAreaView />
      <KeyboardAvoidingView style={{flex:1}} behavior={Platform.OS==="ios"?"padding":undefined}>
        <View style={styles.modalHead}>
          <Text style={styles.modalTitle}>ì£¼ì œ ì œì•ˆ</Text>
          <TouchableOpacity onPress={onClose} hitSlop={12}>
            <Text style={styles.modalClose}>âœ•</Text>
          </TouchableOpacity>
        </View>

        <ScrollView
          style={{flex:1}}
          contentContainerStyle={{padding:14,paddingBottom:120}}
          showsVerticalScrollIndicator={false}
          keyboardShouldPersistTaps="handled"
        >
          <Text style={styles.formLabel}>ì¹´í…Œê³ ë¦¬</Text>
          <View style={styles.dualWrap}>
            {CATS.map(c=>(
              <TouchableOpacity
                key={c.key}
                onPress={()=>setForm(f=>({...f,cat:f.cat===c.key?"":c.key}))}
                style={[
                  styles.formChipHalf,
                  {borderColor:c.color, justifyContent:"center"},
                  form.cat===c.key && {backgroundColor:c.color+"22"}
                ]}
              >
                <Text style={[styles.formChipT,{color:c.color,textAlign:"center"}]} numberOfLines={1}>
                  {c.icon} {c.label}
                </Text>
              </TouchableOpacity>
            ))}
          </View>

          <Text style={styles.formLabel}>ë„ì‹œ</Text>
          <View style={styles.dualRow}>
            <Picker button={"ë„ì‹œ"} value={cityName(form.city)} onPress={()=>setForm(f=>({...f, _cityPick:true}))} />
          </View>

          {form._cityPick && (
            <CitySheetSingle
              current={form.city}
              onPick={(v)=>setForm(f=>({...f,city:v,_cityPick:false}))}
              onClose={()=>setForm(f=>({...f,_cityPick:false}))}
            />
          )}

          <Text style={styles.formLabel}>ì‹œì‘ (24H)</Text>
          <TextInput
            style={styles.input}
            placeholder="HH:MM"
            placeholderTextColor="#738"
            value={form.start}
            onChangeText={t=>setForm(f=>({...f,start:t}))}
          />

          <Text style={styles.formLabel}>ì§„í–‰ì‹œê°„</Text>
          <View style={styles.durationGrid}>
            {DUR_OPTS.map(n=>(
              <TouchableOpacity
                key={n}
                style={[styles.timeChipGrid, form.dur===n && styles.timeChipGridOn]}
                onPress={()=>setDur(n)}
              >
                <Text style={[styles.timeChipGridT, form.dur===n && styles.timeChipGridTOn]}>{n} ë¶„</Text>
              </TouchableOpacity>
            ))}
          </View>

          <Text style={styles.formLabel}>ì£¼ì œ(ì„ íƒ)</Text>
          <TextInput
            style={styles.input}
            placeholder="ì˜ˆ: ìš”ì¦˜ ì„¤ë ˆëŠ” ê²ƒ / ì‹¤íŒ¨ë‹´ / ìƒˆí•´ ëª©í‘œ / ì»¤ë¦¬ì–´ ê³ ë¯¼â€¦"
            placeholderTextColor="#738"
            value={form.topic}
            onChangeText={v=>setForm(f=>({...f,topic:v}))}
          />

          <View style={{flexDirection:"row",gap:8,marginTop:10}}>
            <TouchableOpacity
              style={styles.secondaryBtn}
              onPress={()=>Alert.alert("ì•ˆë‚´", T.boundaryBody)}
            >
              <Text style={styles.secondaryText}>ì•ˆì „/ê²½ê³„</Text>
            </TouchableOpacity>

            <TouchableOpacity style={styles.primaryBtn} onPress={onCreate}>
              <Text style={styles.primaryText}>í”¼ë“œì— ì¶”ê°€</Text>
            </TouchableOpacity>
          </View>

          <Text style={{color:"#6c7686",marginTop:10,fontSize:12,lineHeight:18}}>
            * í…ì…˜ì€ ê¸°ë³¸ì ìœ¼ë¡œ â€œ{currentBand}â€ íƒ­ì—ì„œ ìŠ¬ë¡¯ì´ ë³´ì—¬.
            {"\n"}* ì¹´í˜ëŠ” ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” íƒ€ì…(Brand/Hot/Room) ì¤‘ ëœë¤ìœ¼ë¡œ ë°°ì •ë˜ëŠ” ì»¨ì…‰ì´ì•¼.
          </Text>
        </ScrollView>
      </KeyboardAvoidingView>
    </View>
  );
}

function CitySheetSingle({current,onPick,onClose}){
  return(
    <View style={styles.sheetWrap}>
      <TouchableOpacity style={{flex:1}} onPress={onClose} />
      <View style={styles.sheetCardTall}>
        <View style={styles.sheetHandle}/>
        <Text style={styles.sheetTitle}>ë„ì‹œ ì„ íƒ</Text>
        <ScrollView style={{maxHeight:420}} showsVerticalScrollIndicator={false} overScrollMode="never">
          {CITY_LIST.map(c=>(
            <TouchableOpacity key={c.code} style={styles.cityRow} onPress={()=>onPick(c.code)}>
              <Text style={[styles.cityRowT, current===c.code && {color:"#3EC6FF"}]} numberOfLines={1}>
                {c.name}
              </Text>
            </TouchableOpacity>
          ))}
        </ScrollView>
        <TouchableOpacity style={[styles.primaryBtn,{marginTop:10}]} onPress={onClose}>
          <Text style={styles.primaryText}>ì™„ë£Œ</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
}

function Picker({button,value,onPress}){
  return(
    <TouchableOpacity style={[styles.picker, styles.duo]} onPress={onPress}>
      <Text style={styles.pickerT} numberOfLines={1}>
        {button}: <Text style={{color:"#fff"}}>{value}</Text>
      </Text>
    </TouchableOpacity>
  );
}

/* =========================
   Styles (v1.5 vibe ìœ ì§€)
========================= */
const CONTROL_H = 44;

const styles = StyleSheet.create({
  container:{flex:1,backgroundColor:"#0D0F13"},

  headerRow:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:12,paddingTop:6,marginBottom:6},
  logo:{color:"#fff",fontSize:28,fontWeight:"900"},
  primarySm:{backgroundColor:"#3EC6FF",paddingVertical:9,paddingHorizontal:12,borderRadius:12},
  primarySmT:{color:"#0D0F13",fontWeight:"900"},
  secondarySm:{backgroundColor:"#3EC6FF22",borderWidth:1,borderColor:"#3EC6FF",paddingVertical:9,paddingHorizontal:12,borderRadius:12},
  secondarySmOn:{backgroundColor:"#3EC6FF"},
  secondarySmT:{color:"#3EC6FF",fontWeight:"800"},
  secondarySmTOn:{color:"#0D0F13",fontWeight:"900"},

  catRow:{flexDirection:"row",justifyContent:"space-between",paddingHorizontal:12,marginBottom:8},
  catChip:{width:"23.5%",paddingVertical:10,paddingHorizontal:8,borderWidth:2,borderRadius:14,alignItems:"center",justifyContent:"center"},
  catText:{fontWeight:"900",fontSize:13},

  row2:{flexDirection:"row",gap:8,marginBottom:8,paddingHorizontal:12},
  stepper:{
    flex:1, height:CONTROL_H, borderRadius:12, backgroundColor:"#161A22",
    borderWidth:1, borderColor:"#2A2F38", flexDirection:"row", overflow:"hidden"
  },
  stepBtn:{width:48, alignItems:"center", justifyContent:"center"},
  stepBtnT:{color:"#fff",fontSize:18,fontWeight:"900"},
  stepMid:{flex:1, alignItems:"center", justifyContent:"center", borderLeftWidth:1, borderRightWidth:1, borderColor:"#2A2F38"},
  stepVal:{color:"#fff",fontWeight:"900",fontSize:16,lineHeight:18},
  stepLbl:{color:"#9aa",fontWeight:"700",fontSize:11,marginTop:2},

  sortBtn:{width:110, height:CONTROL_H, borderRadius:12, backgroundColor:"#161A22", borderWidth:1, borderColor:"#2A2F38", alignItems:"center", justifyContent:"center"},
  sortBtnT:{color:"#fff",fontWeight:"900",fontSize:13},

  bandRow:{flexDirection:"row",justifyContent:"space-between",gap:6,marginBottom:8,paddingHorizontal:12},
  bandChip:{flexBasis:"15.5%",height:36,borderRadius:10,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",alignItems:"center",justifyContent:"center"},
  bandChipOn:{backgroundColor:"#3A3F4A"},
  bandChipT:{color:"#9aa",fontWeight:"800",fontSize:12},
  bandChipTOn:{color:"#fff"},

  hotRow:{flexDirection:"row",justifyContent:"space-between",gap:6,marginBottom:8,paddingHorizontal:12},
  cityChip:{flexBasis:"16%",height:36,paddingHorizontal:6,borderRadius:10,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",alignItems:"center",justifyContent:"center"},
  cityChipActive:{backgroundColor:"#3A3F4A"},
  cityChipT:{color:"#9aa",fontWeight:"800",fontSize:12},
  cityChipTActive:{color:"#fff"},
  moreChip:{flexBasis:"16%",height:36,paddingHorizontal:6,borderRadius:10,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",alignItems:"center",justifyContent:"center"},
  moreChipT:{color:"#ddd",fontWeight:"800",fontSize:12},

  search:{backgroundColor:"#141821",color:"#fff",padding:12,borderRadius:12,borderWidth:1,borderColor:"#232833",marginBottom:8,marginHorizontal:12},

  empty:{padding:14,borderRadius:12,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",marginTop:4,marginHorizontal:12},
  emptyT:{color:"#fff",fontWeight:"900",marginBottom:4},
  emptyS:{color:"#9aa"},

  card:{borderWidth:2,borderRadius:12,padding:12,marginBottom:10,marginHorizontal:12},
  cardHead:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:4},
  cardType:{fontWeight:"900",fontSize:12,maxWidth:"65%"},
  cardTitle:{color:"#fff",fontSize:17,fontWeight:"900",marginBottom:6},
  cardLine:{color:"#bbb",fontSize:12,marginBottom:4},
  cardDesc:{color:"#cfe8cf",fontSize:12,marginTop:2},
  progOuter:{height:6,backgroundColor:"#1A1D23",borderRadius:6,overflow:"hidden",marginBottom:6,marginTop:2},
  progInner:{height:6,borderRadius:6},
  cardFoot:{flexDirection:"row",gap:10,marginTop:8},
  outBtn:{borderWidth:1,borderColor:"#555",paddingVertical:8,paddingHorizontal:14,borderRadius:10},
  outBtnT:{color:"#ddd",fontWeight:"800",fontSize:12},
  inBtn:{backgroundColor:"#3EC6FF",paddingVertical:8,paddingHorizontal:14,borderRadius:10},
  inBtnT:{color:"#0D0F13",fontWeight:"900",fontSize:12},

  detailWrap:{position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"#0D0F13"},
  back:{color:"#9aa",marginBottom:12,fontSize:14},
  detailsBox:{borderWidth:2,borderRadius:14,padding:16},
  detailsTitle:{fontSize:22,fontWeight:"900",marginBottom:8},
  badgeRow:{flexDirection:"row",gap:8,marginBottom:8},
  miniBadge:{borderWidth:1,paddingVertical:2,paddingHorizontal:8,borderRadius:8},
  miniBadgeT:{fontSize:11,fontWeight:"800"},

  infoBlock:{backgroundColor:"#11161d",borderWidth:1,borderColor:"#253041",borderRadius:12,padding:12,marginTop:4},
  infoLine:{color:"#dfe7f3",marginBottom:6,fontSize:14},
  section:{marginTop:12},
  secTitle:{color:"#fff",fontWeight:"900",marginBottom:6,fontSize:16},

  policyBox:{backgroundColor:"#101820",borderWidth:1,borderColor:"#2A3748",borderRadius:12,padding:12,marginTop:10},
  policyLine:{color:"#cbd3df",fontSize:13,marginBottom:6},

  sheetWrap:{position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"#0009",justifyContent:"flex-end"},
  sheetCard:{backgroundColor:"#151821",borderTopLeftRadius:16,borderTopRightRadius:16,padding:14,borderWidth:1,borderColor:"#2A2F38"},
  sheetCardTall:{backgroundColor:"#151821",borderTopLeftRadius:16,borderTopRightRadius:16,padding:14,borderWidth:1,borderColor:"#2A2F38",maxHeight:520},
  sheetHandle:{width:44,height:4,backgroundColor:"#2A2F38",borderRadius:2,alignSelf:"center",marginBottom:10},
  sheetTitle:{color:"#fff",fontSize:18,fontWeight:"900",marginBottom:8},
  sheetItem:{paddingVertical:12,borderBottomWidth:1,borderBottomColor:"#262B35"},
  sheetItemT:{color:"#cfd6e4",fontSize:16,fontWeight:"800"},
  cityRow:{flexDirection:"row",alignItems:"center",gap:10,paddingVertical:10,borderBottomWidth:1,borderBottomColor:"#262B35"},
  cityRowT:{color:"#cfd6e4",fontSize:16,fontWeight:"800"},
  chk:{width:20,height:20,borderRadius:6,borderWidth:2,borderColor:"#3EC6FF22",alignItems:"center",justifyContent:"center",backgroundColor:"#1A1D23"},
  chkOn:{borderColor:"#3EC6FF",backgroundColor:"#3EC6FF22"},
  chkT:{color:"#6A7A8E",fontSize:12,fontWeight:"900"},
  chkTOn:{color:"#3EC6FF",fontWeight:"900"},

  modalWrap:{position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:"#0D0F13"},
  modalHead:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:14,paddingTop:6,paddingBottom:6},
  modalTitle:{color:"#fff",fontSize:20,fontWeight:"900"},
  modalClose:{color:"#9aa",fontSize:20,fontWeight:"900"},
  formLabel:{color:"#9aa",marginTop:8,marginBottom:6,fontWeight:"700"},
  dualRow:{flexDirection:"row",gap:8,marginBottom:6},
  duo:{flex:1},
  dualWrap:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",rowGap:8,marginBottom:4},
  formChipHalf:{width:"49%",height:50,paddingHorizontal:12,borderWidth:2,borderRadius:12,alignItems:"center"},
  formChipT:{fontWeight:"900",fontSize:14},
  picker:{height:44,paddingHorizontal:12,borderRadius:10,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",alignItems:"center",justifyContent:"center"},
  pickerT:{color:"#cfd6e4",fontWeight:"800"},
  input:{backgroundColor:"#151821",color:"#fff",padding:12,borderRadius:10,borderWidth:1,borderColor:"#2A2F38",marginBottom:8},

  durationGrid:{flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",rowGap:8,marginBottom:2},
  timeChipGrid:{width:"23%",alignItems:"center",paddingVertical:10,borderRadius:10,backgroundColor:"#1A1D23",borderWidth:1,borderColor:"#2A2F38"},
  timeChipGridOn:{backgroundColor:"#3A3F4A"},
  timeChipGridT:{color:"#9aa",fontWeight:"800",fontSize:12},
  timeChipGridTOn:{color:"#fff"},

  primaryBtn:{backgroundColor:"#3EC6FF",padding:12,borderRadius:10,flex:1},
  primaryText:{color:"#0D0F13",textAlign:"center",fontWeight:"900"},
  secondaryBtn:{backgroundColor:"#3EC6FF22",borderColor:"#3EC6FF",borderWidth:1,padding:12,borderRadius:10,flex:1},
  secondaryText:{color:"#3EC6FF",textAlign:"center",fontWeight:"800"},

  noteBox:{marginTop:10,backgroundColor:"#151821",borderWidth:1,borderColor:"#2A2F38",borderRadius:12,padding:12,marginHorizontal:12},
  note:{color:"#cbd3df",textAlign:"center"},
});
