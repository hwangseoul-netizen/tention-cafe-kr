import React, { useState, useRef } from "react";
import {
  View,
  Text,
  Image,
  ScrollView,
  TouchableOpacity,
  SafeAreaView,
  TextInput,
  StatusBar,
  Dimensions,
  Animated,
} from "react-native";

/**
 * VISUMOF v1.8 â€” íˆ¬ëª…ì„± ë“±ê¸‰ (3 Tier System) ë„ì…
 * - sourceType: 'AI' | 'EDIT' | 'REAL' ë¡œ êµ¬ë¶„
 * - ê° íƒ€ì…ë³„ ë°°ì§€ ë° ì»¬ëŸ¬ ì½”ë”© ì ìš©
 */

const { width: SCREEN_W } = Dimensions.get("window");

const PALETTE = {
  bg: "#FAFAFB",
  card: "#FFFFFF",
  text: "#1F2937",
  sub: "#6B7280",
  line: "#F1F5F9",
  
  // 3ëŒ€ ì†ŒìŠ¤ ì»¬ëŸ¬
  ai: "#A855F7",    // AI Muse (í¼í”Œ)
  edit: "#3B82F6",  // Art Edit (ë¸”ë£¨)
  real: "#10B981",  // Real Cam (ê·¸ë¦°)
  
  brandMint: "#A7F3D0",
};

// ìƒ˜í”Œ ë°ì´í„°ì— sourceType ì ìš©
const MOCK_FEED = [
  {
    id: "ai-001",
    user: "AI Lab",
    sourceType: "AI", // 1. AI ìƒì„±
    category: "í—¤ì–´",
    tags: ["#2025íŠ¸ë Œë“œ", "#ì• ì‰¬ê·¸ë ˆì´", "#ê°€ìƒë””ìì¸"],
    before: "https://images.unsplash.com/photo-1557997977-2f6e7c7038e1?q=80&w=1200",
    after: "https://images.unsplash.com/photo-1596489391038-f947ff9f929d?q=80&w=1200",
    desc: "AIê°€ ì œì•ˆí•˜ëŠ” 2025ë…„ ë´„ í—¤ì–´ ì»¬ëŸ¬ íŠ¸ë Œë“œì…ë‹ˆë‹¤.",
  },
  {
    id: "case-001",
    user: "Glow Clinic",
    sourceType: "EDIT", // 2. ë³´ì •/í¸ì§‘
    category: "ì‹œìˆ ",
    tags: ["#ì¡í‹°ì œê±°", "#í†¤ì—…", "#í”¼ë¶€ê´€ë¦¬"],
    before: "https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?q=80&w=1200",
    after: "https://images.unsplash.com/photo-1522335781184-c34e5b39c1b7?q=80&w=1200",
    desc: "ì‹œìˆ  í›„ ì¡°ëª… ì„¸íŒ… ì´¬ì˜ë³¸ì…ë‹ˆë‹¤. (í”¼ë¶€í†¤ ë³´ì •)",
  },
  {
    id: "case-003",
    user: "Sol",
    sourceType: "REAL", // 3. ë¬´ë³´ì • ë¦¬ì–¼
    category: "ë‹¤ì´ì–´íŠ¸",
    tags: ["#ì•„ì´í°ê¸°ë³¸ì¹´ë©”ë¼", "#ë…¸í•„í„°", "#3ì£¼ë³€í™”"],
    before: "https://images.unsplash.com/photo-1518611012118-696072aa579a?q=80&w=1200",
    after: "https://images.unsplash.com/photo-1544717305-996b815c338c?q=80&w=1200",
    desc: "ë³´ì • 1ë„ ì—†ëŠ” ì° í›„ê¸°ì…ë‹ˆë‹¤. ë•€êµ¬ë©ê¹Œì§€ ë‹¤ ë³´ì„.",
  },
    {
    id: "ai-002",
    user: "Designer J",
    sourceType: "AI",
    category: "ì¸í…Œë¦¬ì–´",
    tags: ["#ë¯¸ë˜í˜•ê±°ì‹¤", "#í”Œëœí…Œë¦¬ì–´", "#ê³µê°„ë””ìì¸"],
    before: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?q=80&w=1200",
    after: "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?q=80&w=1200",
    desc: "6í‰ ì›ë£¸ì„ í˜¸í…”ì²˜ëŸ¼ ë°”ê¾¸ëŠ” AI ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.",
  },
];

/* ë°°ì§€ ì»´í¬ë„ŒíŠ¸: íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥´ê²Œ í‘œì‹œ */
function SourceBadge({ type }) {
  let config = { label: "", color: "", icon: "" };

  switch (type) {
    case "AI":
      config = { label: "AI Muse", color: PALETTE.ai, icon: "âœ¨" };
      break;
    case "EDIT":
      config = { label: "Art Edit", color: PALETTE.edit, icon: "ğŸ¨" };
      break;
    case "REAL":
      config = { label: "Real Cam", color: PALETTE.real, icon: "ğŸ€" };
      break;
    default:
      config = { label: "Unknown", color: "#999", icon: "?" };
  }

  return (
    <View
      style={{
        flexDirection: "row",
        alignItems: "center",
        backgroundColor: `${config.color}15`, // íˆ¬ëª…ë„ 15% ë°°ê²½
        paddingHorizontal: 8,
        paddingVertical: 4,
        borderRadius: 6,
        borderWidth: 1,
        borderColor: `${config.color}40`, // íˆ¬ëª…ë„ 40% í…Œë‘ë¦¬
      }}
    >
      <Text style={{ fontSize: 11, marginRight: 3 }}>{config.icon}</Text>
      <Text style={{ color: config.color, fontWeight: "700", fontSize: 11 }}>
        {config.label}
      </Text>
    </View>
  );
}

function Img({ uri, height = 200 }) {
  return (
    <View style={{ width: "100%", height, backgroundColor: "#E5E7EB", borderRadius: 12, overflow: "hidden" }}>
      <Image source={{ uri }} style={{ width: "100%", height: "100%", resizeMode: "cover" }} />
    </View>
  );
}

function FeedItem({ item }) {
  return (
    <View
      style={{
        backgroundColor: "#FFFFFF",
        borderRadius: 16,
        marginBottom: 24,
        padding: 12,
        // ì†ŒìŠ¤ íƒ€ì…ì— ë”°ë¼ ë¯¸ì„¸í•œ í…Œë‘ë¦¬ ìƒ‰ìƒ ì°¨ì´ (ì§ê´€ì„± UP)
        borderWidth: 1,
        borderColor: item.sourceType === 'AI' ? '#E9D5FF' : '#F1F5F9',
      }}
    >
      {/* í—¤ë” */}
      <View style={{ flexDirection: "row", alignItems: "center", marginBottom: 12 }}>
        <View style={{ width: 36, height: 36, borderRadius: 18, backgroundColor: "#F3F4F6", marginRight: 10, justifyContent:'center', alignItems:'center' }}>
          <Text>{item.user[0]}</Text>
        </View>
        <View style={{ flex: 1 }}>
          <Text style={{ fontWeight: "700", color: PALETTE.text }}>{item.user}</Text>
          <Text style={{ fontSize: 12, color: PALETTE.sub }}>{item.category}</Text>
        </View>
        {/* í•µì‹¬: 3ë‹¨ ë¶„ë¥˜ ë°°ì§€ */}
        <SourceBadge type={item.sourceType} />
      </View>

      {/* ì´ë¯¸ì§€ (ë°˜ë°˜) */}
      <View style={{ flexDirection: "row", gap: 6, marginBottom: 10 }}>
        <View style={{ flex: 1 }}>
            <Img uri={item.before} />
            <View style={{position:'absolute', bottom:6, left:6, backgroundColor:'rgba(0,0,0,0.5)', padding:4, borderRadius:4}}>
                <Text style={{color:'#fff', fontSize:10}}>Before</Text>
            </View>
        </View>
        <View style={{ flex: 1 }}>
            <Img uri={item.after} />
            <View style={{position:'absolute', bottom:6, left:6, backgroundColor:'rgba(0,0,0,0.5)', padding:4, borderRadius:4}}>
                <Text style={{color:'#fff', fontSize:10}}>After</Text>
            </View>
        </View>
      </View>

      {/* ì„¤ëª… ë° íƒœê·¸ */}
      <Text style={{ fontSize: 13, color: PALETTE.text, marginBottom: 6, lineHeight: 18 }}>
        {item.desc}
      </Text>
      <View style={{ flexDirection: "row", flexWrap: "wrap", marginBottom: 10 }}>
        {item.tags.map((t) => (
          <Text key={t} style={{ fontSize: 12, color: PALETTE.sub, marginRight: 6 }}>{t}</Text>
        ))}
      </View>

      {/* ë²„íŠ¼ (AIì¼ ë•Œë§Œ íŒŒíŠ¸ë„ˆ/ìƒë‹´ ë²„íŠ¼ í™œì„±í™” ë“± ë¡œì§ ê°€ëŠ¥) */}
      <TouchableOpacity
        style={{
          backgroundColor: item.sourceType === 'AI' ? PALETTE.brandMint : "#F3F4F6",
          paddingVertical: 12,
          borderRadius: 10,
          alignItems: "center",
        }}
      >
        <Text style={{ fontWeight: "700", fontSize: 13, color: item.sourceType === 'AI' ? "#064E3B" : "#374151" }}>
          {item.sourceType === 'AI' ? "ğŸ·ï¸ ì´ ë””ìì¸ìœ¼ë¡œ íŒŒíŠ¸ë„ˆ ì°¾ê¸°" : "ìì„¸íˆ ë³´ê¸°"}
        </Text>
      </TouchableOpacity>
    </View>
  );
}

/* í—¤ë” ë° ë©”ì¸ */
export default function App() {
    // íƒ­: 'ì „ì²´', 'AI Muse', 'Real Cam' ë“±ìœ¼ë¡œ í•„í„°ë§ ê°€ëŠ¥í•˜ê²Œ í™•ì¥ ê°€ëŠ¥
  return (
    <SafeAreaView style={{ flex: 1, backgroundColor: PALETTE.bg }}>
      <StatusBar barStyle="dark-content" />
      
      {/* ì‹¬í”Œ í—¤ë” */}
      <View style={{ padding: 16, borderBottomWidth: 1, borderColor: PALETTE.line, backgroundColor:'#fff', flexDirection:'row', justifyContent:'space-between', alignItems:'center' }}>
        <Text style={{ fontSize: 20, fontWeight: "900", letterSpacing: -1 }}>
          <Text style={{color:'#FF6B6B'}}>V</Text>
          <Text style={{color:'#FF9F43'}}>I</Text>
          <Text style={{color:'#F6C945'}}>S</Text>
          <Text style={{color:'#1DD1A1'}}>U</Text>
          <Text style={{color:'#48DBFB'}}>M</Text>
          <Text style={{color:'#5F27CD'}}>O</Text>
          <Text style={{color:'#FF6B81'}}>F</Text>
        </Text>
        <View style={{flexDirection:'row', gap:4}}>
            <View style={{width:8, height:8, borderRadius:4, backgroundColor: PALETTE.real}} />
            <View style={{width:8, height:8, borderRadius:4, backgroundColor: PALETTE.edit}} />
            <View style={{width:8, height:8, borderRadius:4, backgroundColor: PALETTE.ai}} />
        </View>
      </View>

      <ScrollView contentContainerStyle={{ padding: 16 }}>
        {MOCK_FEED.map((item) => (
          <FeedItem key={item.id} item={item} />
        ))}
      </ScrollView>
    </SafeAreaView>
  );
}